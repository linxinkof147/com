{"version":3,"sources":["webpack:///E:/笔记/HBuilderProjects/【前端完整代码】仿糗事百科/pages/user-chat/user-chat.vue","webpack:///E:/笔记/HBuilderProjects/【前端完整代码】仿糗事百科/pages/user-chat/user-chat.vue?a0ef","webpack:///E:/笔记/HBuilderProjects/【前端完整代码】仿糗事百科/pages/user-chat/user-chat.vue?75c6","webpack:///E:/笔记/HBuilderProjects/【前端完整代码】仿糗事百科/pages/user-chat/user-chat.vue?1bb6","webpack:///E:/笔记/HBuilderProjects/【前端完整代码】仿糗事百科/pages/user-chat/user-chat.vue?ddd6"],"names":["components","userChatBottom","userChatList","data","scrollTop","style","contentH","itemH","list","loadtext","onLoad","e","userinfo","JSON","parse","userid","uni","showToast","title","icon","navigateBack","delta","$chat","CurrentToUser","username","userpic","setNavigationBarTitle","onUnload","onReady","__init","methods","res","getSystemInfoSync","windowHeight","upx2px","getdata","pageToBottom","$on","push","__format","type","isme","olddata","isfirst","isscrollToBottom","q","createSelectorQuery","in","selectAll","$nextTick","fields","size","i","length","height","exec","isall","key","User","id","getStorageSync","splice","submit","result","send","$http","post","token","checkToken","checkAuth","err","errorCheck","loadmore"],"mappings":"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","file":"pages/user-chat/user-chat.js","sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport userChatBottom from \"../../components/user-chat/user-chat-bottom.vue\";\nimport time from \"../../common/time.js\";\nimport userChatList from \"../../components/user-chat/user-chat-list.vue\";\nexport default {\n\tcomponents:{\n\t\tuserChatBottom,\n\t\tuserChatList\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tscrollTop:0,\n\t\t\tstyle:{\n\t\t\t\tcontentH:0,\n\t\t\t\titemH:0\n\t\t\t},\n\t\t\tlist:[],\n\t\t\tloadtext:\"点击加载更多\"\n\t\t};\n\t},\n\tonLoad(e) {\n\t\tlet userinfo = JSON.parse(e.userinfo);\n\t\t// 用户不存在\n\t\tif (!userinfo.userid) {\n\t\t\tuni.showToast({ title: '该用户不存在',icon:\"none\" });\n\t\t\treturn uni.navigateBack({ delta: 1 });\n\t\t}\n\t\t// 初始化聊天对象\n\t\tthis.$chat.CurrentToUser = {\n\t\t\tuserid:userinfo.userid,\n\t\t\tusername:userinfo.username,\n\t\t\tuserpic:userinfo.userpic,\n\t\t};\n\t\t// 修改标题\n\t\tuni.setNavigationBarTitle({ title:userinfo.username })\n\t},\n\tonUnload() {\n\t\t// 初始化聊天对象\n\t\tthis.$chat.CurrentToUser = {\n\t\t\tuserid:0,\n\t\t\tusername:\"\",\n\t\t\tuserpic:\"\",\n\t\t};\n\t},\n\tonReady() {\n\t\tthis.__init();\n\t},\n\tmethods:{\n\t\t// 初始化参数\n\t\t__init(){\n\t\t\t// 获取窗口信息\n\t\t\ttry {\n\t\t\t\tconst res = uni.getSystemInfoSync();\n\t\t\t\tthis.style.contentH=res.windowHeight - uni.upx2px(120);\n\t\t\t} catch (e) { }\n\t\t\t// 获取聊天历史记录\n\t\t\tthis.getdata();\n\t\t\t// 至于底部\n\t\t\tthis.pageToBottom(true);\n\t\t\t// 开启监听\n\t\t\tuni.$on('UserChat',(data)=>{\n\t\t\t\tthis.list.push(this.$chat.__format(data,{ \n\t\t\t\t\ttype:\"chatdetail\",\n\t\t\t\t\tisme:false,\n\t\t\t\t\tolddata:this.list\n\t\t\t\t}));\n\t\t\t\tthis.pageToBottom();\n\t\t\t})\n\t\t},\n\t\tpageToBottom(isfirst = false,isscrollToBottom = true){\n\t\t\tlet q=uni.createSelectorQuery().in(this);\n\t\t\tlet itemH = q.selectAll('.chat-item');\n\t\t\tthis.$nextTick(()=>{\n\t\t\t\titemH.fields({\n\t\t\t\t\tsize:true\n\t\t\t\t},data => {\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tif (isfirst) {\n\t\t\t\t\t\t\tthis.style.itemH = 0;\n\t\t\t\t\t\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\t\t\t\t\t\tthis.style.itemH += data[i].height;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tthis.style.itemH += data.length>0 ? data[data.length-1].height : data[0].height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (isscrollToBottom) {\n\t\t\t\t\t\t\tthis.scrollTop = (this.style.itemH > this.style.contentH) ? this.style.itemH : 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).exec();\n\t\t\t})\n\t\t},\n\t\t// 获取聊天数据（只获取10条）\n\t\tgetdata(isall = false){\n\t\t\ttry{\n\t\t\t\tlet key = 'chatdetail_'+this.User.userinfo.id+'_'+this.$chat.CurrentToUser.userid;\n\t\t\t\tlet list = uni.getStorageSync(key);\n\t\t\t\tlist = list ? JSON.parse(list) : [];\n\t\t\t\t// 首次加载十条\n\t\t\t\tif (!isall && list.length > 10) {\n\t\t\t\t\treturn this.list = list.splice(0,10);\n\t\t\t\t}\n\t\t\t\t// 加载剩下的数据\n\t\t\t\tthis.list = list;\n\t\t\t\tthis.loadtext = '';\n\t\t\t}catch(e){\n\t\t\t\tuni.showToast({ title: '加载失败~', icon: 'none' });\n\t\t\t}\n\t\t},\n\t\tasync submit(data){\n\t\t\tif (!data) {\n\t\t\t\treturn uni.showToast({ title: '请输入你要发送的消息~', icon: 'none' });\n\t\t\t}\n\t\t\tlet result = this.$chat.send({ type:'text',data:data });\n\t\t\tlet [err,res] = await this.$http.post('/chat/send',result,{\n\t\t\t\ttoken:true,\n\t\t\t\tcheckToken:true,\n\t\t\t\tcheckAuth:true\n\t\t\t});\n\t\t\tif (!this.$http.errorCheck(err,res)) {\n\t\t\t\treturn uni.showToast({\n\t\t\t\t\ttitle: '发送失败',icon:\"none\"\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.list.push(this.$chat.__format(result,{\n\t\t\t\ttype:\"chatdetail\", // 转化类型\n\t\t\t\tolddata:this.list,\n\t\t\t\tisme:true\n\t\t\t}));\n\t\t\tthis.pageToBottom();\n\t\t},\n\t\t// 加载更多\n\t\tloadmore(){\n\t\t\tif(this.loadtext !== \"点击加载更多\") return;\n\t\t\t// 修改状态\n\t\t\tthis.loadtext=\"加载中...\";\n\t\t\tthis.getdata(true);\n\t\t\tthis.pageToBottom(true,false);\n\t\t},\n\t}\n}\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./user-chat.vue?vue&type=template&id=74b8ff5d&\"\nimport script from \"./user-chat.vue?vue&type=script&lang=js&\"\nexport * from \"./user-chat.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('74b8ff5d', component.options)\n    } else {\n      api.reload('74b8ff5d', component.options)\n    }\n    module.hot.accept(\"./user-chat.vue?vue&type=template&id=74b8ff5d&\", function () {\n      api.rerender('74b8ff5d', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"E:/笔记/HBuilderProjects/【前端完整代码】仿糗事百科/pages/user-chat/user-chat.vue\"\nexport default component.exports","import mod from \"-!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./user-chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./user-chat.vue?vue&type=script&lang=js&\"","export * from \"-!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\软件\\\\HBuilderX.2.0.2.20190614-alpha\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./user-chat.vue?vue&type=template&id=74b8ff5d&\""],"sourceRoot":""}