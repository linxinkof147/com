(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-chat-user-chat"],{"0efe":function(t,e,i){"use strict";i.r(e);var n=i("b3f6"),a=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,function(){return n[t]})}(r);e["default"]=a.a},"21e1":function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,'.user-chat-list[data-v-8c395c10]{padding:%?20?% 0}.user-chat-list>uni-image[data-v-8c395c10]{width:%?100?%;height:%?100?%;border-radius:100%;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.user-chat-list-body[data-v-8c395c10]{position:relative;background:#f4f4f4;padding:%?25?%;margin-left:%?20?%;border-radius:%?20?%;margin-right:%?100?%}.user-chat-list-body[data-v-8c395c10]:after{position:absolute;left:%?-30?%;right:0;top:%?30?%;content:"";width:0;height:0;border:%?16?% solid #f4f4f4;border-color:rgba(0,0,0,0) #f4f4f4 rgba(0,0,0,0) rgba(0,0,0,0)}.user-chat-me[data-v-8c395c10]{-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end}.user-chat-me .user-chat-list-body[data-v-8c395c10]{margin-right:%?20?%;margin-left:%?100?%}.user-chat-me .user-chat-list-body[data-v-8c395c10]:after{left:auto;right:%?-30?%;border-color:rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0) #f4f4f4}.user-chat-list-body>uni-image[data-v-8c395c10]{max-width:%?150?%;max-height:%?200?%}.user-chat-time[data-v-8c395c10]{padding:%?50?% 0;color:#a2a2a2;font-size:%?24?%}',""])},"271a":function(t,e,i){var n=i("8499");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("4f06").default;a("0f5ecc2b",n,!0,{sourceMap:!1,shadowMode:!1})},"2d76":function(t,e,i){"use strict";i.r(e);var n=i("da42"),a=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,function(){return n[t]})}(r);e["default"]=a.a},4566:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"user-chat-bottom u-f-ac animated fadeInDown fast"},[i("v-uni-input",{attrs:{type:"text",placeholder:"文明发言",focus:t.focus},on:{blur:function(e){e=t.$handleEvent(e),t.blur(e)}},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}),i("v-uni-view",{staticClass:"icon iconfont icon-fabu u-f-ajc",on:{click:function(e){e=t.$handleEvent(e),t.submit(e)}}})],1)},a=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return a})},4762:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={props:{item:Object,index:Number}};e.default=n},"48dd":function(t,e,i){"use strict";i.r(e);var n=i("9009"),a=i("2d76");for(var r in a)"default"!==r&&function(t){i.d(e,t,function(){return a[t]})}(r);var o=i("2877"),s=Object(o["a"])(a["default"],n["a"],n["b"],!1,null,"2dbce034",null);e["default"]=s.exports},"4a4e":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"user-chat-item animated fadeIn fast"},[t.item.gstime?i("v-uni-view",{staticClass:"user-chat-time u-f-ajc"},[t._v(t._s(t.item.gstime))]):t._e(),i("v-uni-view",{staticClass:"user-chat-list u-f",class:{"user-chat-me":t.item.isme}},[t.item.isme?t._e():i("v-uni-image",{attrs:{src:t.item.userpic,"lazy-load":""}}),i("v-uni-view",{staticClass:"user-chat-list-body"},["text"==t.item.type?i("v-uni-text",[t._v(t._s(t.item.data))]):t._e(),"img"==t.item.type?i("v-uni-image",{attrs:{src:t.item.data,mode:"widthFix","lazy-load":""}}):t._e()],1),t.item.isme?i("v-uni-image",{attrs:{src:t.item.userpic,"lazy-load":""}}):t._e()],1)],1)},a=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return a})},"5af0":function(t,e,i){"use strict";var n=i("be1e"),a=i.n(n);a.a},"66ec":function(t,e,i){"use strict";var n=i("271a"),a=i.n(n);a.a},8499:function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,".user-chat-bottom[data-v-578802d2]{position:fixed;bottom:0;left:0;right:0;height:%?120?%;padding:0 %?20?%;background:#fff;border-top:%?1?% solid #eee}.user-chat-bottom>uni-input[data-v-578802d2]{-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;margin-right:%?20?%;padding:%?10?% %?20?%;border-radius:%?10?%;background:#f7f7f7}.user-chat-bottom>uni-view[data-v-578802d2]{width:%?80?%;font-size:%?45?%}",""])},9009:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-scroll-view",{style:{height:t.style.contentH+"px"},attrs:{id:"scrollview","scroll-y":"","scroll-top":t.scrollTop,"scroll-with-animation":!0}},[i("v-uni-view",{staticClass:"u-f-ajc chat-load-more",attrs:{"hover-class":"chat-load-more-hover"},on:{click:function(e){e=t.$handleEvent(e),t.loadmore(e)}}},[t._v(t._s(t.loadtext))]),t._l(t.list,function(t,e){return[i("v-uni-view",{key:e+"_0",staticClass:"chat-item"},[i("user-chat-list",{attrs:{item:t,index:e}})],1)]})],2),i("user-chat-bottom",{on:{submit:function(e){e=t.$handleEvent(e),t.submit(e)}}})],1)},a=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return a})},aaa0:function(t,e,i){"use strict";i.r(e);var n=i("4566"),a=i("0efe");for(var r in a)"default"!==r&&function(t){i.d(e,t,function(){return a[t]})}(r);i("66ec");var o=i("2877"),s=Object(o["a"])(a["default"],n["a"],n["b"],!1,null,"578802d2",null);e["default"]=s.exports},b16e:function(t,e,i){"use strict";i.r(e);var n=i("4a4e"),a=i("d2fd");for(var r in a)"default"!==r&&function(t){i.d(e,t,function(){return a[t]})}(r);i("5af0");var o=i("2877"),s=Object(o["a"])(a["default"],n["a"],n["b"],!1,null,"8c395c10",null);e["default"]=s.exports},b3f6:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={props:{focus:{type:Boolean,default:!1}},data:function(){return{text:""}},methods:{submit:function(){this.$emit("submit",this.text),this.text=""},blur:function(){this.$emit("blur")}}};e.default=n},be1e:function(t,e,i){var n=i("21e1");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("4f06").default;a("6cf1ea85",n,!0,{sourceMap:!1,shadowMode:!1})},d2fd:function(t,e,i){"use strict";i.r(e);var n=i("4762"),a=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,function(){return n[t]})}(r);e["default"]=a.a},da42:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(i("a34a")),a=o(i("aaa0")),r=(o(i("e6ae")),o(i("b16e")));function o(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return l(t)||c(t,e)||u()}function u(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(t,e){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)if(i.push(o.value),e&&i.length===e)break}catch(u){a=!0,r=u}finally{try{n||null==s["return"]||s["return"]()}finally{if(a)throw r}}return i}function l(t){if(Array.isArray(t))return t}function f(t,e,i,n,a,r,o){try{var s=t[r](o),u=s.value}catch(c){return void i(c)}s.done?e(u):Promise.resolve(u).then(n,a)}function d(t){return function(){var e=this,i=arguments;return new Promise(function(n,a){var r=t.apply(e,i);function o(t){f(r,n,a,o,s,"next",t)}function s(t){f(r,n,a,o,s,"throw",t)}o(void 0)})}}var h={components:{userChatBottom:a.default,userChatList:r.default},data:function(){return{scrollTop:0,style:{contentH:0,itemH:0},list:[],loadtext:"点击加载更多"}},onLoad:function(t){var e=JSON.parse(t.userinfo);if(!e.userid)return uni.showToast({title:"该用户不存在",icon:"none"}),uni.navigateBack({delta:1});this.$chat.CurrentToUser={userid:e.userid,username:e.username,userpic:e.userpic},uni.setNavigationBarTitle({title:e.username})},onUnload:function(){this.$chat.CurrentToUser={userid:0,username:"",userpic:""}},onReady:function(){this.__init()},methods:{__init:function(){var t=this;try{var e=uni.getSystemInfoSync();this.style.contentH=e.windowHeight-uni.upx2px(120)}catch(i){}this.getdata(),this.pageToBottom(!0),uni.$on("UserChat",function(e){t.list.push(t.$chat.__format(e,{type:"chatdetail",isme:!1,olddata:t.list})),t.pageToBottom()})},pageToBottom:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=uni.createSelectorQuery().in(this),a=n.selectAll(".chat-item");this.$nextTick(function(){a.fields({size:!0},function(n){if(n){if(e){t.style.itemH=0;for(var a=0;a<n.length;a++)t.style.itemH+=n[a].height}else t.style.itemH+=n.length>0?n[n.length-1].height:n[0].height;i&&(t.scrollTop=t.style.itemH>t.style.contentH?t.style.itemH:0)}}).exec()})},getdata:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var e="chatdetail_"+this.User.userinfo.id+"_"+this.$chat.CurrentToUser.userid,i=uni.getStorageSync(e);if(i=i?JSON.parse(i):[],!t&&i.length>10)return this.list=i.splice(0,10);this.list=i,this.loadtext=""}catch(n){uni.showToast({title:"加载失败~",icon:"none"})}},submit:function(){var t=d(n.default.mark(function t(e){var i,a,r,o,u;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",uni.showToast({title:"请输入你要发送的消息~",icon:"none"}));case 2:return i=this.$chat.send({type:"text",data:e}),t.next=5,this.$http.post("/chat/send",i,{token:!0,checkToken:!0,checkAuth:!0});case 5:if(a=t.sent,r=s(a,2),o=r[0],u=r[1],this.$http.errorCheck(o,u)){t.next=11;break}return t.abrupt("return",uni.showToast({title:"发送失败",icon:"none"}));case 11:this.list.push(this.$chat.__format(i,{type:"chatdetail",olddata:this.list,isme:!0})),this.pageToBottom();case 13:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),loadmore:function(){"点击加载更多"===this.loadtext&&(this.loadtext="加载中...",this.getdata(!0),this.pageToBottom(!0,!1))}}};e.default=h}}]);